# Telegram Reply-Aware Filtering Module Configuration
# This module detects replies to trusted messages and applies score reductions

# Load the Lua module
lua = "telegram_replies.lua";

# Symbol definitions and scores
symbols = {
    # Main reply symbol (applied to all replies to trusted messages)
    "TG_REPLY" {
        weight = -2.0;
        description = "Reply to trusted message";
        group = "telegram_replies";
    }
    
    # Specific reply symbols based on trust type
    "TG_REPLY_BOT" {
        weight = -3.0;
        description = "Reply to bot message";
        group = "telegram_replies";
    }
    
    "TG_REPLY_ADMIN" {
        weight = -2.0;
        description = "Reply to admin message";
        group = "telegram_replies";
    }
    
    "TG_REPLY_VERIFIED" {
        weight = -1.0;
        description = "Reply to verified user message";
        group = "telegram_replies";
    }
    
    # Tracking symbol for replies to trusted messages
    "TG_REPLY_TRACKED" {
        weight = -1.0;
        description = "Message is tracked reply to trusted message";
        group = "telegram_replies";
    }
    
    # Anti-evasion symbols for spam patterns in replies
    "TG_REPLY_LINK_SPAM" {
        weight = 2.0;
        description = "Excessive links in reply to trusted message";
        group = "telegram_replies";
    }
    
    "TG_REPLY_PHONE_SPAM" {
        weight = 1.5;
        description = "Phone number spam in reply to trusted message";
        group = "telegram_replies";
    }
    
    "TG_REPLY_INVITE_SPAM" {
        weight = 3.0;
        description = "Invite link spam in reply to trusted message";
        group = "telegram_replies";
    }
    
    "TG_REPLY_CAPS_SPAM" {
        weight = 1.0;
        description = "Excessive caps in reply to trusted message";
        group = "telegram_replies";
    }
}

# Module settings
settings {
    # Redis configuration
    redis_host = "127.0.0.1";
    redis_port = 6379;
    redis_db = 0;
    redis_timeout = 1.0;
    
    # Score reduction limits
    max_score_reduction = -5.0;
    
    # TTL settings
    trusted_message_ttl = 86400;  # 24 hours
    reply_tracking_ttl = 604800;  # 7 days
    
    # Enable/disable features
    enable_reply_detection = true;
    enable_spam_pattern_check = true;
    enable_reply_tracking = true;
}

# Force actions for replies to trusted messages
# This can be used to completely bypass filtering for certain types of replies
force_actions {
    # Completely bypass filtering for replies to bot messages
    # (uncomment if you want this behavior)
    # "TG_REPLY_BOT" {
    #     action = "no action";
    #     score_threshold = 0;
    # }
    
    # Reduce action severity for replies to admin messages
    # "TG_REPLY_ADMIN" {
    #     action = "add header";
    #     score_threshold = 5;
    # }
} 